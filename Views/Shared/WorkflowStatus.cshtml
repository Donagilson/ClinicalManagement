@using ClinicalManagementSystem2025.Models

@functions {
    private string GetWorkflowStepStatus(string currentStatus, string step)
    {
        return currentStatus switch
        {
            "Scheduled" => step == "scheduled" ? "active" : "pending",
            "Confirmed" => step == "scheduled" || step == "confirmed" ? "active" : step == "inprogress" || step == "visited" || step == "completed" ? "pending" : "disabled",
            "InProgress" => step == "scheduled" || step == "confirmed" || step == "inprogress" ? "active" : step == "visited" || step == "completed" ? "pending" : "disabled",
            "Visited" => step == "scheduled" || step == "confirmed" || step == "inprogress" || step == "visited" ? "active" : step == "completed" ? "pending" : "disabled",
            "Completed" => step == "scheduled" || step == "confirmed" || step == "inprogress" || step == "visited" || step == "completed" ? "active" : "disabled",
            "Cancelled" => "cancelled",
            _ => "pending"
        };
    }

    private string GetStepIcon(string step)
    {
        return step switch
        {
            "scheduled" => "fas fa-calendar-plus",
            "confirmed" => "fas fa-calendar-check",
            "inprogress" => "fas fa-user-md",
            "visited" => "fas fa-stethoscope",
            "completed" => "fas fa-check-circle",
            "cancelled" => "fas fa-times-circle",
            _ => "fas fa-question-circle"
        };
    }

    private string GetStepTitle(string step)
    {
        return step switch
        {
            "scheduled" => "Scheduled",
            "confirmed" => "Confirmed",
            "inprogress" => "In Progress",
            "visited" => "Patient Visited",
            "completed" => "Completed",
            "cancelled" => "Cancelled",
            _ => "Unknown"
        };
    }
}

@if (ViewBag.AppointmentInfo != null)
{
    var appointment = ViewBag.AppointmentInfo as Appointment;
    <div class="workflow-status mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom-0">
                <h6 class="mb-0 text-muted">
                    <i class="fas fa-route me-2"></i>Appointment Workflow Status
                </h6>
            </div>
            <div class="card-body">
                <div class="workflow-steps">
                    <div class="step @GetWorkflowStepStatus(appointment?.Status ?? "", "scheduled")">
                        <div class="step-icon">
                            <i class="@GetStepIcon("scheduled")"></i>
                        </div>
                        <div class="step-label">@GetStepTitle("scheduled")</div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step @GetWorkflowStepStatus(appointment?.Status ?? "", "confirmed")">
                        <div class="step-icon">
                            <i class="@GetStepIcon("confirmed")"></i>
                        </div>
                        <div class="step-label">@GetStepTitle("confirmed")</div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step @GetWorkflowStepStatus(appointment?.Status ?? "", "inprogress")">
                        <div class="step-icon">
                            <i class="@GetStepIcon("inprogress")"></i>
                        </div>
                        <div class="step-label">@GetStepTitle("inprogress")</div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step @GetWorkflowStepStatus(appointment?.Status ?? "", "visited")">
                        <div class="step-icon">
                            <i class="@GetStepIcon("visited")"></i>
                        </div>
                        <div class="step-label">@GetStepTitle("visited")</div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step @GetWorkflowStepStatus(appointment?.Status ?? "", "completed")">
                        <div class="step-icon">
                            <i class="@GetStepIcon("completed")"></i>
                        </div>
                        <div class="step-label">@GetStepTitle("completed")</div>
                    </div>
                </div>

                @if (appointment?.Status == "Cancelled")
                {
                    <div class="text-center mt-3">
                        <span class="badge bg-danger">
                            <i class="fas fa-times-circle me-1"></i>Appointment Cancelled
                        </span>
                    </div>
                }
            </div>
        </div>
    </div>
}

<style>
.workflow-status .workflow-steps {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
}

.workflow-status .step {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    position: relative;
}

.workflow-status .step-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-bottom: 8px;
    transition: all 0.3s ease;
    border: 3px solid #e9ecef;
    background: white;
}

.workflow-status .step.active .step-icon {
    border-color: #7b68ee;
    background: #7b68ee;
    color: white;
}

.workflow-status .step.completed .step-icon {
    border-color: #28a745;
    background: #28a745;
    color: white;
}

.workflow-status .step.cancelled .step-icon {
    border-color: #dc3545;
    background: #dc3545;
    color: white;
}

.workflow-status .step.pending .step-icon {
    border-color: #6c757d;
    background: white;
    color: #6c757d;
}

.workflow-status .step-label {
    font-size: 12px;
    text-align: center;
    font-weight: 600;
    color: #6c757d;
}

.workflow-status .step.active .step-label {
    color: #7b68ee;
}

.workflow-status .step.completed .step-label {
    color: #28a745;
}

.workflow-status .step.cancelled .step-label {
    color: #dc3545;
}

.workflow-status .step-connector {
    flex: 1;
    height: 3px;
    background: #e9ecef;
    margin: 0 10px;
    position: relative;
    top: -25px;
}

.workflow-status .step.active ~ .step .step-connector,
.workflow-status .step.completed ~ .step .step-connector {
    background: #28a745;
}

.workflow-status .step.cancelled .step-connector {
    background: #dc3545;
}



    .workflow-status .step-connector {
        width: 3px;
        height: 20px;
        margin: 10px 0;
        top: 0;
    }
}
</style>
